# Документация по реализации приложения компьютерного зрения

## Общее описание

Данное приложение представляет собой модульную систему компьютерного зрения, предназначенную для обнаружения, распознавания и отслеживания объектов на видеопотоке. Приложение имеет единый графический интерфейс с вкладками для различных режимов работы и функций.

Основные возможности приложения:
- Калибровка камеры с использованием доски ChArUco
- Обнаружение и распознавание объектов на видеопотоке
- Сбор данных с ручной маркировкой объектов
- Анализ собранных данных и генерация диапазонов для распознавания
- Работа в режиме реального времени с передачей данных на робота

## Структура проекта

Проект имеет модульную структуру, где каждый модуль отвечает за определенную функциональность:

1. **variables.py** - модуль с глобальными переменными и настройками
2. **calibration.py** - модуль калибровки камеры
3. **computer_vision.py** - модуль обработки изображений и распознавания объектов
4. **data_collection.py** - модуль сбора данных и ручной маркировки
5. **analysis.py** - модуль анализа собранных данных
6. **working_mode.py** - модуль рабочего режима для обработки видеопотока
7. **robot_comm.py** - модуль коммуникации с роботом
8. **main.py** - основной модуль с GUI-интерфейсом

## Детали реализации модулей

### variables.py

Модуль содержит все глобальные константы и настройки, необходимые для работы приложения:
- Пути к файлам (калибровка, видео, конфигурация)
- Параметры камеры и отображения
- Параметры трекинга объектов
- Параметры калибровки камеры
- Параметры детекции объектов
- Параметры GUI
- Режимы работы

Централизованное хранение настроек позволяет легко изменять конфигурацию проекта без необходимости вносить изменения в исходный код других модулей.

### calibration.py

Модуль реализует калибровку камеры с использованием доски ChArUco:
- Класс `CalibrationManager` управляет процессом калибровки
- Методы для добавления кадров, вычисления параметров калибровки, сохранения и загрузки данных
- Генерация изображения доски ChArUco для печати

Калибровка происходит путём последовательного захвата кадров с доской ChArUco, извлечения углов и последующего вычисления параметров камеры (матрица камеры и коэффициенты дисторсии).

### computer_vision.py

Модуль реализует алгоритмы обработки изображений и распознавания объектов:
- Функции для предварительной обработки изображений (размытие, выделение краёв)
- Вычисление геометрических признаков объектов
- Распознавание объектов на основе конфигурации
- Класс `ObjectDetector` для обнаружения и трекинга объектов

Модуль использует OpenCV для обработки изображений и SciPy для решения задачи о назначениях при трекинге объектов.

### data_collection.py

Модуль реализует интерактивный интерфейс для ручной маркировки объектов:
- Функция `label_object_composite` для выбора формы и цвета объекта
- Сохранение данных об объектах в CSV-файлы
- Извлечение региона интереса (ROI) вокруг объекта
- Обработка объектов без категории

Модуль позволяет собирать данные для последующего анализа и улучшения распознавания.

### analysis.py

Модуль обеспечивает загрузку, обработку и анализ собранных данных:
- Загрузка данных из CSV-файлов
- Вычисление дополнительных признаков (норма Hu-моментов, среднее значение цвета)
- Статистический анализ признаков
- Генерация диапазонов значений для идентификации объектов

Результаты анализа могут быть использованы для настройки параметров распознавания.

### working_mode.py

Модуль реализует режим работы в реальном времени:
- Обработка видеопотока с камеры или из видеофайла
- Применение коррекции искажений
- Отображение обработанного изображения с наложенной информацией
- Передача данных на робота

Модуль обеспечивает непрерывную обработку видеопотока в реальном времени.

### robot_comm.py

Модуль обеспечивает передачу данных обнаруженных объектов на систему управления роботом:
- Функция `send_data_to_robot` для отправки данных
- Класс `RobotCommunicator` для управления коммуникацией
- Поддержка различных типов соединений (консоль, последовательный порт, TCP)

На начальном этапе реализуется демонстрационный вариант с выводом параметров в консоль, но структура модуля рассчитана на дальнейшее расширение.

### main.py

Основной модуль приложения, который организует запуск всего приложения и объединяет работу всех модулей:
- Класс `MainWindow` для создания главного окна приложения с вкладками
- Инициализация и настройка GUI-интерфейса
- Обработка событий пользователя
- Координация работы всех модулей

Графический интерфейс реализован с использованием PyQt5 и имеет вкладки для разных режимов работы.

## Взаимодействие модулей

1. **main.py** инициализирует компоненты из других модулей:
   - `CalibrationManager` из calibration.py
   - `ObjectDetector` из computer_vision.py
   - `RobotCommunicator` из robot_comm.py

2. В режиме калибровки:
   - Захватываются кадры с камеры или из видеофайла
   - Кадры передаются в `CalibrationManager` для обнаружения углов доски ChArUco
   - После сбора достаточного количества кадров вычисляются параметры калибровки
   - Параметры сохраняются в файл для последующего использования

3. В режиме сбора данных:
   - Захватываются кадры с камеры или из видеофайла
   - Кадры обрабатываются с помощью `ObjectDetector` для обнаружения объектов
   - Если объект не распознан, вызывается функция `label_object_composite` для ручной маркировки
   - Данные об объектах сохраняются в CSV-файлы

4. В режиме анализа:
   - Загружаются данные из CSV-файлов с помощью функций из analysis.py
   - Вычисляются статистические показатели признаков
   - Генерируются диапазоны значений для идентификации объектов
   - Диапазоны могут быть сохранены в конфигурацию для распознавания

5. В рабочем режиме:
   - Захватываются кадры с камеры или из видеофайла
   - Применяется коррекция искажений с использованием параметров калибровки
   - Кадры обрабатываются с помощью `ObjectDetector` для обнаружения и распознавания объектов
   - Если включена отправка данных на робота, информация об объектах передается через `RobotCommunicator`

## Требования к системе

- Python 3.6 или выше
- PyQt5 для графического интерфейса
- OpenCV для обработки изображений
- NumPy для работы с массивами
- pandas для анализа данных
- SciPy для решения задачи о назначениях при трекинге

## Запуск приложения

Для запуска приложения необходимо выполнить следующие шаги:

1. Установить необходимые зависимости:
```
pip install PyQt5 opencv-python numpy pandas scipy
```

2. Запустить основной модуль:
```
python main.py
```

При первом запуске приложение предложит выполнить калибровку камеры, если калибровочные данные отсутствуют.

## Заключение

Данное приложение представляет собой модульную систему компьютерного зрения с единым графическим интерфейсом. Модульная структура обеспечивает гибкость и расширяемость системы, а единый интерфейс упрощает взаимодействие пользователя с приложением.

Приложение может быть использовано для обнаружения, распознавания и отслеживания объектов на видеопотоке, а также для сбора данных и анализа признаков объектов.
